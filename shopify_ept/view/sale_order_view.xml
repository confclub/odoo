<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>


        <record id="sale.view_order_form" model="ir.ui.view">
            <field name="name">sale.order.form</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <form string="Sales Order" class="o_sale_order" js_class="sale_discount_form">
                    <header>
                        <field name="authorized_transaction_ids" invisible="1"/>
                        <button name="payment_action_capture" type="object"
                                string="Capture Transaction" class="oe_highlight"
                                attrs="{'invisible': [('authorized_transaction_ids', '=', [])]}"/>
                        <button name="payment_action_void" type="object"
                                string="Void Transaction"
                                confirm="Are you sure you want to void the authorized transaction? This action can't be undone."
                                attrs="{'invisible': [('authorized_transaction_ids', '=', [])]}"/>
                        <button name="%(sale.action_view_sale_advance_payment_inv)d" string="Create Invoice"
                                type="action" class="btn-primary"
                                attrs="{'invisible': [('invoice_status', '!=', 'to invoice')]}"/>
                        <button name="%(sale.action_view_sale_advance_payment_inv)d" string="Create Invoice"
                                type="action" context="{'default_advance_payment_method': 'percentage'}"
                                attrs="{'invisible': ['|',('invoice_status', '!=', 'no'), ('state', '!=', 'sale')]}"/>
                        <button name="action_quotation_send" string="Send by Email" type="object" states="draft"
                                class="btn-primary"/>
                        <button name="action_quotation_send" type="object" string="Send PRO-FORMA Invoice"
                                groups="sale.group_proforma_sales" class="btn-primary"
                                attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('invoice_count','&gt;=',1)]}"
                                context="{'proforma': True}"/>
                        <button name="action_confirm" id="action_confirm"
                                string="Confirm" class="btn-primary" type="object"
                                attrs="{'invisible': [('state', 'not in', ['sent'])]}"/>
                        <button name="action_confirm"
                                string="Confirm" type="object"
                                attrs="{'invisible': [('state', 'not in', ['draft'])]}"/>
                        <button name="action_quotation_send" type="object" string="Send PRO-FORMA Invoice"
                                groups="sale.group_proforma_sales"
                                attrs="{'invisible': ['|', ('state', '=', 'draft'), ('invoice_count','&gt;=',1)]}"
                                context="{'proforma': True}"/>
                        <button name="action_quotation_send" string="Send by Email" type="object" states="sent,sale"/>
                        <button name="action_cancel" type="object" string="Cancel"
                                attrs="{'invisible': ['|', ('state', 'not in', ['draft', 'sent','sale']), ('id', '=', False)]}"/>
                        <button name="action_draft" states="cancel" type="object" string="Set to Quotation"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,sent,sale"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="preview_sale_order"
                                    type="object"
                                    class="oe_stat_button"
                                    icon="fa-globe icon">
                                <div class="o_field_widget o_stat_info">
                                    <span class="o_stat_text">Customer</span>
                                    <span class="o_stat_text">Preview</span>
                                </div>
                            </button>
                            <button name="action_view_invoice"
                                    type="object"
                                    class="oe_stat_button"
                                    icon="fa-pencil-square-o"
                                    attrs="{'invisible': [('invoice_count', '=', 0)]}">
                                <field name="invoice_count" widget="statinfo" string="Invoices"/>
                            </button>
                        </div>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>
                        <group name="sale_header">
                            <group name="partner_details">
                                <field name="partner_id"/>
                                <field name="partner_invoice_id" groups="sale.group_delivery_invoice_address"
                                       context="{'default_type':'invoice','show_address': 1, 'show_vat': True}"
                                       options='{"always_reload": True}'/>
                                <field name="partner_shipping_id" groups="sale.group_delivery_invoice_address"
                                       context="{'default_type':'delivery','show_address': 1, 'show_vat': True}"
                                       options='{"always_reload": True}'/>
                            </group>
                            <group name="order_details">
                                <field name="validity_date" attrs="{'invisible': [('state', 'in', ['sale', 'done'])]}"/>
                                <div class="o_td_label" groups="base.group_no_one"
                                     attrs="{'invisible': [('state', 'in', ['sale', 'done', 'cancel'])]}">
                                    <label for="date_order" string="Quotation Date"/>
                                </div>
                                <field name="date_order" nolabel="1" groups="base.group_no_one"
                                       attrs="{'invisible': [('state', 'in', ['sale', 'done', 'cancel'])]}"/>
                                <div class="o_td_label" attrs="{'invisible': [('state', 'in', ['draft', 'sent'])]}">
                                    <label for="date_order" string="Order Date"/>
                                </div>
                                <field name="date_order"
                                       attrs="{'required': [('state', 'in', ['sale', 'done'])], 'invisible': [('state', 'in', ['draft', 'sent'])]}"
                                       nolabel="1"/>
                                <field name="show_update_pricelist" invisible="1"/>
                                <label for="pricelist_id" groups="product.group_product_pricelist"/>
                                <div groups="product.group_product_pricelist" class="o_row">
                                    <field name="pricelist_id" options="{'no_open':True,'no_create': True}"/>
                                    <button name="update_prices" type="object"
                                            string=" Update Prices"
                                            help="Recompute all prices based on this pricelist"
                                            class="btn-link mb-1 px-0" icon="fa-refresh"
                                            confirm="This will update all unit prices based on the currently set pricelist."
                                            attrs="{'invisible': ['|', ('show_update_pricelist', '=', False), ('state', 'in', ['sale', 'done','cancel'])]}"/>
                                </div>
                                <field name="currency_id" invisible="1"/>
                                <field name="payment_term_id" options="{'no_open':True,'no_create': True}"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Order Lines" name="order_lines">
                                <field
                                        name="order_line"
                                        widget="section_and_note_one2many"
                                        mode="tree,kanban"
                                        attrs="{'readonly': [('state', 'in', ('done','cancel'))]}"
                                >
                                    <form>
                                        <field name="display_type" invisible="1"/>
                                        <!--
                                            We need the sequence field to be here for new lines to be added at the correct position.
                                            TODO: at some point we want to fix this in the framework so that an invisible field is not required.
                                        -->
                                        <field name="sequence" invisible="1"/>
                                        <field name="product_uom_category_id" invisible="1"/>
                                        <group>
                                            <group attrs="{'invisible': [('display_type', '!=', False)]}">
                                                <field name="product_updatable" invisible="1"/>
                                                <field name="product_id"
                                                       domain="[('sale_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                                                       context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
                                                       attrs="{
                                                    'readonly': [('product_updatable', '=', False)],
                                                    'required': [('display_type', '=', False)],
                                                }"
                                                       force_save="1"
                                                       widget="many2one_barcode"
                                                />
                                                <field name="invoice_status" invisible="1"/>
                                                <field name="qty_to_invoice" invisible="1"/>
                                                <field name="qty_delivered_manual" invisible="1"/>
                                                <field name="qty_delivered_method" invisible="1"/>
                                                <field name="price_total" invisible="1"/>
                                                <field name="price_tax" invisible="1"/>
                                                <field name="price_subtotal" invisible="1"/>
                                                <field name="product_uom_readonly" invisible="1"/>
                                                <label for="product_uom_qty"/>
                                                <div class="o_row" name="ordered_qty">
                                                    <field
                                                            context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'uom_qty_change':True, 'company_id': parent.company_id}"
                                                            name="product_uom_qty"/>
                                                    <field
                                                            name="product_uom"
                                                            force_save="1"
                                                            groups="uom.group_uom"
                                                            class="oe_no_button"
                                                            attrs="{
                                                        'readonly': [('product_uom_readonly', '=', True)],
                                                        'required': [('display_type', '=', False)],
                                                    }"
                                                    />
                                                </div>
                                                <label for="qty_delivered" string="Delivered"
                                                       attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}"/>
                                                <div name="delivered_qty"
                                                     attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}">
                                                    <field name="qty_delivered"
                                                           attrs="{'readonly': [('qty_delivered_method', '!=', 'manual')]}"/>
                                                </div>
                                                <label for="qty_invoiced" string="Invoiced"
                                                       attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}"/>
                                                <div name="invoiced_qty"
                                                     attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}">
                                                    <field name="qty_invoiced"
                                                           attrs="{'invisible': [('parent.state', 'not in', ['sale', 'done'])]}"/>
                                                </div>
                                                <field name="price_unit"/>
                                                <field name="tax_id" widget="many2many_tags"
                                                       options="{'no_create': True}"
                                                       context="{'search_view_ref': 'account.account_tax_view_search'}"
                                                       domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id)]"
                                                       attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"/>
                                                <label for="discount" groups="product.group_discount_per_so_line"/>
                                                <div name="discount" groups="product.group_discount_per_so_line">
                                                    <field name="discount" class="oe_inline"/>
                                                    %%
                                                </div>
                                                <!--
                                                    We need the sequence field to be here
                                                    because we want to be able to overwrite the default sequence value in the JS
                                                    in order for new lines to be added at the correct position.
                                                    NOTE: at some point we want to fix this in the framework so that an invisible field is not required.
                                                -->
                                                <field name="sequence" invisible="1"/>
                                            </group>
                                            <group attrs="{'invisible': [('display_type', '!=', False)]}">
                                                <label for="customer_lead"/>
                                                <div name="lead">
                                                    <field name="customer_lead" class="oe_inline"/>
                                                    days
                                                </div>
                                                <field name="analytic_tag_ids" widget="many2many_tags"
                                                       groups="analytic.group_analytic_tags"
                                                       options="{'color_field': 'color'}"
                                                       domain="['|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"/>
                                            </group>
                                        </group>
                                        <label for="name" string="Description"
                                               attrs="{'invisible': [('display_type', '!=', False)]}"/>
                                        <label for="name" string="Section Name (eg. Products, Services)"
                                               attrs="{'invisible': [('display_type', '!=', 'line_section')]}"/>
                                        <label for="name" string="Note"
                                               attrs="{'invisible': [('display_type', '!=', 'line_note')]}"/>
                                        <field name="name"/>
                                        <div name="invoice_lines" groups="base.group_no_one"
                                             attrs="{'invisible': [('display_type', '!=', False)]}">
                                            <label for="invoice_lines"/>
                                            <field name="invoice_lines"/>
                                        </div>
                                        <field name="state" invisible="1"/>
                                        <field name="company_id" invisible="1"/>
                                    </form>
                                    <tree
                                            string="Sales Order Lines"
                                            editable="bottom"
                                    >
                                        <control>
                                            <create name="add_product_control" string="Add a product"/>
                                            <create name="add_section_control" string="Add a section"
                                                    context="{'default_display_type': 'line_section'}"/>
                                            <create name="add_note_control" string="Add a note"
                                                    context="{'default_display_type': 'line_note'}"/>
                                        </control>

                                        <field name="sequence" widget="handle"/>
                                        <!-- We do not display the type because we don't want the user to be bothered with that information if he has no section or note. -->
                                        <field name="display_type" invisible="1"/>
                                        <field name="product_uom_category_id" invisible="1"/>

                                        <field name="product_updatable" invisible="1"/>
                                        <field
                                                name="product_id"
                                                attrs="{
                                            'readonly': [('product_updatable', '=', False)],
                                            'required': [('display_type', '=', False)],
                                        }"
                                                options="{'no_open': True}"
                                                force_save="1"
                                                context="{
                                            'partner_id': parent.partner_id,
                                            'quantity': product_uom_qty,
                                            'pricelist': parent.pricelist_id,
                                            'uom':product_uom,
                                            'company_id': parent.company_id,
                                            'default_lst_price': price_unit,
                                            'default_description_sale': name
                                        }"
                                                domain="[('sale_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                                                widget="product_configurator"
                                        />
                                        <field name="product_template_id"
                                               string="Product"
                                               invisible="1"
                                               attrs="{
                                          'readonly': [('product_updatable', '=', False)],
                                          'required': [('display_type', '=', False)],
                                      }"
                                               options="{'no_open': True}"
                                               context="{
                                          'partner_id': parent.partner_id,
                                          'quantity': product_uom_qty,
                                          'pricelist': parent.pricelist_id,
                                          'uom':product_uom,
                                          'company_id': parent.company_id,
                                          'default_list_price': price_unit,
                                          'default_description_sale': name
                                      }"
                                               domain="[('sale_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                                               widget="product_configurator"/>
                                        <field name="name" widget="section_and_note_text" optional="show"/>
                                        <field
                                                name="analytic_tag_ids"
                                                optional="hide"
                                                groups="analytic.group_analytic_tags"
                                                widget="many2many_tags"
                                                options="{'color_field': 'color'}"
                                                domain="['|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                                        />
                                        <field
                                                name="product_uom_qty"
                                                decoration-info="(not display_type and invoice_status == 'to invoice')"
                                                decoration-bf="(not display_type and invoice_status == 'to invoice')"
                                                context="{
                                            'partner_id': parent.partner_id,
                                            'quantity': product_uom_qty,
                                            'pricelist': parent.pricelist_id,
                                            'uom': product_uom,
                                            'company_id': parent.company_id
                                        }"
                                        />
                                        <field
                                                name="qty_delivered"
                                                decoration-info="(not display_type and invoice_status == 'to invoice')"
                                                decoration-bf="(not display_type and invoice_status == 'to invoice')"
                                                string="Delivered"
                                                attrs="{
                                            'column_invisible': [('parent.state', 'not in', ['sale', 'done'])],
                                            'readonly': [('qty_delivered_method', '!=', 'manual')]
                                        }"
                                                optional="show"
                                        />
                                        <field name="qty_delivered_manual" invisible="1"/>
                                        <field name="qty_delivered_method" invisible="1"/>
                                        <field
                                                name="qty_invoiced"
                                                decoration-info="(not display_type and invoice_status == 'to invoice')"
                                                decoration-bf="(not display_type and invoice_status == 'to invoice')"
                                                string="Invoiced"
                                                attrs="{'column_invisible': [('parent.state', 'not in', ['sale', 'done'])]}"
                                                optional="show"
                                        />
                                        <field name="qty_to_invoice" invisible="1"/>
                                        <field name="product_uom_readonly" invisible="1"/>
                                        <field
                                                name="product_uom"
                                                force_save="1"
                                                string="UoM"
                                                attrs="{
                                            'readonly': [('product_uom_readonly', '=', True)],
                                            'required': [('display_type', '=', False)],
                                        }"
                                                context="{'company_id': parent.company_id}"
                                                groups="uom.group_uom"
                                                options='{"no_open": True}'
                                                optional="show"
                                        />
                                        <field
                                                name="customer_lead"
                                                optional="hide"
                                                attrs="{'readonly': [('parent.state', 'not in', ['draft', 'sent', 'sale'])]}"
                                        />
                                        <field
                                                name="price_unit"
                                                attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"
                                        />
                                        <field
                                                name="tax_id"
                                                widget="many2many_tags"
                                                options="{'no_create': True}"
                                                domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id)]"
                                                attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"
                                                optional="show"
                                        />
                                        <field name="discount" string="Disc.%"
                                               groups="product.group_discount_per_so_line" optional="show"
                                               widget="product_discount"/>
                                        <field name="price_subtotal" widget="monetary"
                                               groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <field name="price_total" widget="monetary"
                                               groups="account.group_show_line_subtotals_tax_included"/>
                                        <field name="state" invisible="1"/>
                                        <field name="invoice_status" invisible="1"/>
                                        <field name="currency_id" invisible="1"/>
                                        <field name="price_tax" invisible="1"/>
                                        <field name="company_id" invisible="1"/>
                                    </tree>
                                    <kanban class="o_kanban_mobile">
                                        <field name="name"/>
                                        <field name="product_id"/>
                                        <field name="product_uom_qty"/>
                                        <field name="product_uom" groups="uom.group_uom"/>
                                        <field name="price_subtotal"/>
                                        <field name="price_total"/>
                                        <field name="price_tax" invisible="1"/>
                                        <field name="price_total" invisible="1"/>
                                        <field name="price_unit"/>
                                        <field name="display_type"/>
                                        <field name="tax_id" invisible="1"/>
                                        <field name="company_id" invisible="1"/>
                                        <templates>
                                            <t t-name="kanban-box">
                                                <div t-attf-class="oe_kanban_card oe_kanban_global_click {{ record.display_type.raw_value ? 'o_is_' + record.display_type.raw_value : '' }}">
                                                    <t t-if="!record.display_type.raw_value">
                                                        <div class="row">
                                                            <div class="col-8">
                                                                <strong>
                                                                    <span>
                                                                        <t t-esc="record.product_id.value"/>
                                                                    </span>
                                                                </strong>
                                                            </div>
                                                            <div class="col-4">
                                                                <strong>
                                                                    <span class="float-right text-right">
                                                                        <t t-set="line_price"
                                                                           t-value="record.price_subtotal.value"
                                                                           groups="account.group_show_line_subtotals_tax_excluded"/>
                                                                        <t t-set="line_price"
                                                                           t-value="record.price_total.value"
                                                                           groups="account.group_show_line_subtotals_tax_included"/>
                                                                        <t t-esc="line_price"/>
                                                                    </span>
                                                                </strong>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-12 text-muted">
                                                                <span>
                                                                    Quantity:
                                                                    <t t-esc="record.product_uom_qty.value"/>
                                                                    <t t-esc="record.product_uom.value"/>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-12 text-muted">
                                                                <span>
                                                                    Unit Price:
                                                                    <t t-esc="record.price_unit.value"/>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </t>
                                                    <t t-if="record.display_type.raw_value === 'line_section' || record.display_type.raw_value === 'line_note'">
                                                        <div class="row">
                                                            <div class="col-12">
                                                                <span>
                                                                    <t t-esc="record.name.value"/>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </t>
                                                </div>
                                            </t>
                                        </templates>
                                    </kanban>
                                </field>
                                <group name="note_group" col="6" class="mt-2 mt-md-0">
                                    <group colspan="4">
                                        <field name="note" nolabel="1" placeholder="Terms and conditions..."/>
                                    </group>
                                    <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
                                        <field name="amount_untaxed" widget='monetary'
                                               options="{'currency_field': 'currency_id'}"/>
                                        <field name="amount_tax" widget='monetary'
                                               options="{'currency_field': 'currency_id'}"/>
                                        <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                            <label for="amount_total"/>
                                        </div>
                                        <field name="amount_total" nolabel="1" class="oe_subtotal_footer_separator"
                                               widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                    </group>
                                    <div class="oe_clear"/>
                                </group>
                            </page>
                            <page string="Other Info" name="other_information">
                                <group>
                                    <group name="sales_person" string="Sales">
                                        <field name="user_id" domain="[('share', '=', False)]"
                                               widget="many2one_avatar_user"/>
                                        <field name="team_id" kanban_view_ref="%(sales_team.crm_team_view_kanban)s"
                                               options="{'no_create': True}"/>
                                        <field name="company_id" options="{'no_create': True}"
                                               groups="base.group_multi_company"/>
                                        <field name="require_signature"/>
                                        <field name="require_payment"/>
                                        <field name="reference" readonly="1"
                                               attrs="{'invisible': [('reference', '=', False)]}"/>
                                        <field name="client_order_ref"/>
                                        <field name="tag_ids" widget="many2many_tags"
                                               options="{'color_field': 'color', 'no_create_edit': True}"/>
                                    </group>
                                    <group name="sale_info" string="Invoicing">
                                        <field name="fiscal_position_id" options="{'no_create': True}"/>
                                        <field name="analytic_account_id"
                                               context="{'default_partner_id':partner_invoice_id, 'default_name':name}"
                                               attrs="{'readonly': [('invoice_count','!=',0),('state','=','sale')]}"
                                               groups="analytic.group_analytic_accounting" force_save="1"/>
                                        <field name="invoice_status" states="sale,done" groups="base.group_no_one"/>
                                    </group>
                                </group>
                                <group>
                                    <group name="sale_shipping">
                                        <label for="commitment_date" string="Delivery Date"/>
                                        <div name="commitment_date_div" class="o_row">
                                            <field name="commitment_date"/>
                                            <span name="expected_date_span" class="text-muted">Expected:
                                                <field name="expected_date" widget="date"/>
                                            </span>
                                        </div>
                                    </group>
                                    <group string="Reporting" name="sale_reporting" groups="base.group_no_one">
                                        <group name="technical" colspan="2" class="mb-0">
                                            <field name="origin"/>
                                        </group>
                                        <group name="utm_link" colspan="2" class="mt-0">
                                            <field name="campaign_id"/>
                                            <field name="medium_id"/>
                                            <field name="source_id"/>
                                        </group>
                                    </group>
                                </group>
                            </page>
                            <page groups="base.group_no_one" string="Customer Signature" name="customer_signature"
                                  attrs="{'invisible': [('require_signature', '=', False), ('signed_by', '=', False), ('signature', '=', False), ('signed_on', '=', False)]}">
                                <group>
                                    <field name="signed_by"/>
                                    <field name="signed_on"/>
                                    <field name="signature" widget="image"/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>


        <record model="ir.ui.view" id="sale.account_invoice_form">
            <field name="name">Account Invoice</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
                <data>
                    <xpath expr="//field[@name='partner_id']" position="after">
                        <field name="partner_shipping_id"
                               groups="sale.group_delivery_invoice_address"
                               context="{'default_type':'delivery','show_address': 1, 'show_vat': True}"
                               options='{"always_reload": True}'
                               attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund'))]}"/>
                        <field name="partner_invoice_id" groups="sale.group_delivery_invoice_address"
                               context="{'default_type':'delivery','show_address': 1, 'show_vat': True}"
                               options='{"always_reload": True}'
                               attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund'))]}"/>
                    </xpath>
                    <xpath expr="//field[@name='partner_id']" position="replace">
                        <field name="partner_id" nolabel="1"/>
                    </xpath>

                    <xpath expr="//field[@name='invoice_line_ids']//field[@name='discount']" position="attributes">
                        <attribute name="groups">product.group_discount_per_so_line</attribute>
                    </xpath>
                    <xpath expr="//group[@name='sale_info_group']/field[@name='invoice_user_id']" position="after">
                        <field name="team_id" kanban_view_ref="%(sales_team.crm_team_view_kanban)s"/>
                    </xpath>
                    <xpath expr="//group[@id='other_tab_group']" position="inside">
                        <group string="Marketing"
                               name="utm_link"
                               groups="base.group_no_one"
                               attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund'))]}">
                            <field name="campaign_id"/>
                            <field name="medium_id"/>
                            <field name="source_id"/>
                        </group>
                    </xpath>
                </data>
            </field>
        </record>


        <!--This is use for Cancel button -->
        <record id="view_sale_form_ept" model="ir.ui.view">
            <field name="name">sale.order.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <button name="action_cancel" position="after">
                    <field name="canceled_in_shopify" invisible="1"/>
                    <field name="shopify_instance_id" invisible="1"/>
                    <button name="cancel_in_shopify" string="Cancel In Shopify"
                            type="object"
                            attrs="{'invisible':['|','|',('state','!=','cancel'),('canceled_in_shopify','=',True),('shopify_instance_id','=',False)]}"
                            class="oe_highlight">
                    </button>
                </button>
            </field>
        </record>


        <record id="view_sale_order_tree_inherit" model="ir.ui.view">
            <field name="name">sale.order.tree</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//tree/field[@name='state']" position="after">
                    <field name="partially_delivered"/>
                    <field name="fully_delivered"/>
                    <field name="fully_paid"/>
                    <field name="refund"/>
                </xpath>
                <xpath expr="//tree/field[@name='amount_total']" position="before">
                    <field name="refunded_amount" sum="Total Tax Included" widget="monetary" decoration-bf="1"
                           optional="show"/>
                </xpath>

            </field>
        </record>


        <!--Tree view of shopify sale order -->
        <record id="view_order_tree_shopify_ept" model="ir.ui.view">
            <field name="name">sale.order.tree</field>
            <field name="model">sale.order</field>
            <field name="priority">100</field>
            <field name="arch" type="xml">
                <tree sample="1" decoration-success="updated_in_shopify==True" decoration-muted="state=='cancel'"
                      decoration-info="state in ('waiting_date','manual')"
                      decoration-danger="state in ('invoice_except','shipping_except')" create="false">
                    <field name="name" string="Order Number" decoration-bf="1"/>
                    <field name="date_order"/>
                    <field name="partner_id"/>
                    <field name="user_id" widget="many2one_avatar_user"/>
                    <field name="amount_total" sum="Total Tax Included" widget="monetary" decoration-bf="1"/>
                    <field name="state" decoration-success="state == 'sale' or state == 'done'"
                           decoration-info="state == 'draft' or state == 'sent'" widget="badge"/>
                    <field name="risk_ids" invisible="1"/>
                    <field name="is_risky_order" invisible="1"/>
                    <field name="updated_in_shopify" widget="boolean_toggle" readonly="1"/>
                </tree>
            </field>
        </record>

        <!--        <record id="shopify_view_sales_order_filter" model="ir.ui.view">-->
        <!--            <field name="model">sale.order</field>-->
        <!--            <field name="inherit_id" ref="sale.view_sales_order_filter"/>-->
        <!--            <field name="arch" type="xml">-->
        <!--                <filter name="my_sale_orders_filter" position="after">-->
        <!--                    <filter string="Shipped Order"-->
        <!--                            domain="[('shopify_order_status', '=', 'fulfilled')]"-->
        <!--                            help="While import order from shopify at time shipped order"-->
        <!--                            name="shopify_order_status"/>-->
        <!--                    <filter string="Order status updated in Shopify"-->
        <!--                            name="order_status_updated"-->
        <!--                            domain="[('updated_in_shopify', '=', True)]"/>-->
        <!--                    <filter string="Order status not updated in Shopify"-->
        <!--                            name="order_status_not_updated"-->
        <!--                            domain="[('updated_in_shopify', '=', False)]"/>-->
        <!--                </filter>-->
        <!--            </field>-->
        <!--        </record>-->

        <!--Form view of shopify shopify sale order -->
        <record id="view_order_form" model="ir.ui.view">
            <field name="name">sale.order.form.inherit</field>
            <field name="model">sale.order</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='order_line']/tree/field[@name='name']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <data>
                    <notebook position="inside">
                        <page string="Shopify Info"
                              attrs="{'invisible':[('shopify_instance_id','=',False)]}">
                            <group>
                                <group>
                                    <field name="shopify_order_id" readonly="True"/>
                                    <field name="shopify_order_number" readonly="True"/>
                                    <field name="shopify_payment_gateway_id" readonly="True"/>
                                    <field name="shopify_instance_id" readonly="True"
                                           options="{'no_create':True,'no_create_edit':True}"/>
                                    <field name="shopify_order_status" readonly="True"/>
                                    <field name="sale_api_data"/>
                                </group>
                                <group>
                                    <field name="is_risky_order"/>
                                    <field name="checkout_id" readonly="True"/>
                                    <field name="closed_at_ept" readonly="True"/>
                                    <field name="shopify_location_id" readonly="1"/>
                                    <field name="is_pos_order" readonly="1" invisible="1"/>
                                </group>
                            </group>
                            <group string="Risks">
                                <field name="risk_ids" readonly="1" nolabel="1">
                                    <tree>
                                        <field name="name"/>
                                        <field name="cause_cancel"/>
                                        <field name="display"/>
                                        <field name="recommendation"/>
                                        <field name="score"/>
                                        <field name="source"/>
                                    </tree>
                                    <form>
                                        <group>
                                            <group>
                                                <field name="name"/>
                                                <field name="risk_id"/>
                                                <field name="recommendation"/>
                                            </group>
                                            <group>
                                                <field name="cause_cancel"/>
                                                <field name="display"/>
                                                <field name="score"/>
                                            </group>
                                        </group>
                                        <group string="Message">
                                            <field name="message" nolabel="1"/>
                                        </group>
                                    </form>
                                </field>
                            </group>
                        </page>
                    </notebook>
                </data>
            </field>
        </record>

        <!--Action of shopify sale quotation -->
        <record id="action_shopify_sale_quotation"
                model="ir.actions.act_window">
            <field name="name">Shopify Quotations</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{"not_shopify_order":False}</field>
            <field name="domain">
                [('shopify_order_id','!=',False),('state','in',('draft','sent','cancel'))]
            </field>
            <field name="view_id" ref="view_order_tree_shopify_ept"/>
            <field name="search_view_id" ref="sale.view_sales_order_filter"/>
            <field name="help" type="html">
                <div class="oe_empty_shopify_sale_quotation">
                    <br/>
                    <br/>
                    <br/>
                    <p>
                        <b>There is no any Sale Quotation synchronised from any of your
                            Shopify
                            Instance yet.
                        </b>
                    </p>
                    <p>
                        You can't create Sale Quotation manually and push it to Shopify.
                        Through
                        only import Sale Quotation from
                        any of your Shopify Instance, you can see your Quotation here.Import
                        Sale
                        Quotation can be performed by 2 ways.
                    </p>
                    <p>
                        <b>1.</b>
                        Via automatic jobs to import Sale Quotation at frequent amount of
                        time.
                        <br/>
                        Go to Shopify
                        <i class="fa fa-angle-double-right"/>
                        Settings
                        <i class="fa fa-angle-double-right"/>
                        Instances and open the instance.
                        <br/>
                        Activate automatic Job for Import orders by clicking the 'Configure Schedulers'.
                    </p>
                    <p>
                        <b>2.</b>
                        Manually Import Orders at any time
                        <br/>
                        Go to menu Shopify
                        <i class="fa fa-angle-double-right"/>
                        Processes
                        <i class="fa fa-angle-double-right"/>
                        Shopify Operations and select
                        your
                        instances and option "Import Orders".
                        Clicking on "OK" button will import all
                        <b>Open</b>
                        orders from Shopify to
                        ERP.
                    </p>
                    <p>
                        <b>3.</b>
                        At the time of import order,you must configure workflow order
                        status.
                        <br/>
                        Go to Shopify<i class="fa fa-angle-double-right"/>Configuration
                        <i class="fa fa-angle-double-right"/>
                        Financial Status
                    </p>
                </div>
            </field>
        </record>

        <!--Action of Shopify Sale Order -->
        <record id="action_shopify_sales_order"
                model="ir.actions.act_window">
            <field name="name">Shopify Sales Order</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{"not_shopify_order":False}</field>
            <field name="domain">[('shopify_order_id','!=',False),('state','in',('sale','done'))]
            </field>
            <field name="view_id" ref="view_order_tree_shopify_ept"/>
            <field name="search_view_id" ref="sale.view_sales_order_filter"/>
            <field name="help" type="html">
                <div class="oe_empty_shopify_sale_order">
                    <br/>
                    <br/>
                    <br/>
                    <p>
                        <b>There is no any Sale Order synchronised from any of your
                            Shopify Instance
                            yet.
                        </b>
                    </p>
                    <p>
                        You can't create Sale Order manually and push it to Shopify. Through
                        only
                        import Sale Order from
                        any of your Shopify Instance, you can see your Orders here.Import
                        Sale Order
                        can be performed by 2 ways.
                    </p>
                    <p>
                        <b>1.</b>
                        Via automatic jobs to import Sale Orders at frequent amount of
                        time.
                        <br/>
                        Go to Shopify
                        <i class="fa fa-angle-double-right"/>
                        Settings
                        <i class="fa fa-angle-double-right"/>
                        Instances and open the instance.
                        <br/>
                        Activate automatic Job for Import orders by clicking the 'Configure Schedulers'.
                    </p>
                    <p>
                        <b>2.</b>
                        Manually Import Orders at any time
                        <br/>
                        Go to menu Shopify
                        <i class="fa fa-angle-double-right"/>
                        Processes
                        <i class="fa fa-angle-double-right"/>
                        Shopify Operations and select
                        your
                        instances and option "Import Orders".
                        Clicking on "OK" button will import all
                        <b>Unshipped/Partial Shipped</b>
                        orders
                        from Shopify to ERP.
                    </p>
                    <p>
                        <b>3.</b>
                        At the time of import order,you must configure workflow order
                        status.
                        <br/>
                        Go to Shopify<i class="fa fa-angle-double-right"/>Configuration
                        <i class="fa fa-angle-double-right"/>
                        Financial Status
                    </p>

                </div>
            </field>
        </record>

        <record id="action_shopify_risky_quotations"
                model="ir.actions.act_window">
            <field name="name">Risky Quotations</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{"not_shopify_order":False}</field>
            <field name="domain">[('shopify_order_id','!=',False),('is_risky_order','!=',False)]
            </field>
            <field name="view_id" ref="view_order_tree_shopify_ept"/>
            <field name="search_view_id" ref="sale.view_sales_order_filter"/>
            <field name="help" type="html">
                <div class="oe_empty_shopify_sale_quotation">
                    <br/>
                    <br/>
                    <br/>
                    <p>
                        <b>There is no any Sale Quotation synchronised from any of your
                            Shopify
                            Instance yet.
                        </b>
                    </p>
                    <p>
                        You can't create Sale Quotation manually and push it to Shopify.
                        Through
                        only import Sale Quotation from
                        any of your Shopify Instance, you can see your Quotation here.Import
                        Sale
                        Quotation can be performed by 2 ways.
                    </p>
                    <p>
                        <b>1.</b>
                        Via automatic jobs to import Sale Quotation at frequent amount of
                        time.
                        <br/>
                        Go to Shopify
                        <i class="fa fa-angle-double-right"/>
                        Settings
                        <i class="fa fa-angle-double-right"/>
                        Instances and open the instance.
                        <br/>
                        Activate automatic Job for Import orders by clicking the 'Configure Schedulers'.
                    </p>
                    <p>
                        <b>2.</b>
                        Manually Import Orders at any time
                        <br/>
                        Go to menu Shopify
                        <i class="fa fa-angle-double-right"/>
                        Processes
                        <i class="fa fa-angle-double-right"/>
                        Shopify Operations and select
                        your
                        instances and option "Import Orders".
                        Clicking on "OK" button will import all
                        <b>Open</b>
                        orders from Shopify to
                        ERP.
                    </p>
                    <p>
                        <b>3.</b>
                        At the time of import order,you must configure workflow order
                        status.
                        <br/>
                        Go to Shopify<i class="fa fa-angle-double-right"/>Configuration
                        <i class="fa fa-angle-double-right"/>
                        Financial Status
                    </p>
                </div>
            </field>
        </record>

        <record id="action_shopify_instance_sale_quotation"
                model="ir.actions.act_window">
            <field name="name">Shopify Quotations</field>
            <field name="res_model">sale.order</field>
            <field name="view_id" ref="view_order_tree_shopify_ept"/>
            <field name="domain">
                [('shopify_order_id','!=',False),('state','in',('draft','sent','cancel')),('shopify_instance_id','=',active_id)]
            </field>
        </record>

        <record id="action_shopify_sale_instance_ept"
                model="ir.actions.act_window">
            <field name="name">Shopify Orders</field>
            <field name="res_model">sale.order</field>
            <field name="view_id" ref="view_order_tree_shopify_ept"/>
            <field name="domain">[('shopify_instance_id','=',active_id)]</field>
        </record>

        <record id="action_shopify_instance_sales_order_only"
                model="ir.actions.act_window">
            <field name="name">Shopify Sales Order</field>
            <field name="res_model">sale.order</field>
            <field name="view_id" ref="view_order_tree_shopify_ept"/>
            <field name="domain">[('shopify_order_id','!=',False),
                ('state','not
                in',('draft','sent','cancel')),('shopify_instance_id','=',active_id)]
            </field>
        </record>

        <record id="action_shopify_instance_risky_quotation"
                model="ir.actions.act_window">
            <field name="name">Shopify Risky Quotations</field>
            <field name="res_model">sale.order</field>
            <field name="view_id" ref="view_order_tree_shopify_ept"/>
            <field name="context">{"not_shopify_order":False}</field>
            <field name="domain">
                [('shopify_order_id','!=',False),('state','=','draft'),('is_risky_order','!=',False),('shopify_instance_id','=',active_id)]
            </field>
        </record>

        <!--Main of Sale -->
        <menuitem id="shopify_menu_item_sales" name="Sales" parent="shopify_ept.shopify_instance_menu_item"
                  sequence="4"/>

        <menuitem id="shopify_order_parent_menu" name="Orders" parent="shopify_ept.shopify_menu_item_sales"
                  sequence="7"/>

        <!--Quotation Order menuitem -->
        <menuitem id="shopify_menu_item_quotation_order" name="Quotations"
                  parent="shopify_ept.shopify_order_parent_menu" action="action_shopify_sale_quotation" sequence="5"/>

        <!--Risky Order menuitem -->
        <menuitem id="shopify_menu_item_risky_quotation_order" name="Risky Quotations"
                  parent="shopify_ept.shopify_order_parent_menu" action="action_shopify_risky_quotations"
                  sequence="10"/>

        <!--Confirm Order menuitem -->
        <menuitem id="shopify_menu_item_sales_order" name="Sales Order" parent="shopify_ept.shopify_order_parent_menu"
                  action="action_shopify_sales_order" sequence="15"/>
    </data>
</odoo>
	